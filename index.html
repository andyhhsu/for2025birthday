<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一個只屬於妳的挑戰</title>
    <style>
        /* --- 整體頁面樣式 --- */
        :root {
            --bg-color: #282a36;
            --container-bg: #44475a;
            --text-color: #f8f8f2;
            --primary-color: #ff79c6;
            --secondary-color: #f1fa8c;
            --accent-color: #50fa7b;
            --border-color: #bd93f9;
        }
        html {
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Georgia', 'Times New Roman', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px; /* 增加左右邊距給手機 */
            transition: background-color 0.5s ease;
        }

        /* --- 主要內容容器 --- */
        .container {
            background-color: var(--container-bg);
            padding: 20px; /* 手機上內距小一點 */
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.5s ease;
        }

        /* --- 標題與文字 --- */
        h1, h2 { color: var(--primary-color); }
        h1 { font-size: 1.8em; }
        p { line-height: 1.8; font-size: 1.1em; }

        /* --- 謎題 --- */
        .riddle {
            font-style: italic;
            color: var(--secondary-color);
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* --- 輸入區域 --- */
        .input-area {
            margin-top: 20px;
            display: flex;
            flex-direction: column; /* 手機上垂直排列 */
            align-items: center;
            gap: 10px;
        }
        #answer-input {
            padding: 12px;
            border-radius: 5px;
            border: 2px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1em;
            text-align: center;
            width: 100%; /* 填滿寬度 */
            max-width: 300px; /* 但不要過寬 */
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            background-color: var(--accent-color);
            color: var(--bg-color);
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 300px;
        }
        button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        /* --- 線索紀錄欄位 --- */
        #clue-tracker {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            color: var(--secondary-color);
            font-size: 1em;
            letter-spacing: 2px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 100;
            text-align: center;
        }
        .container { margin-top: 60px; }

        /* --- 成功過關的樣式 --- */
        .success-view img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid var(--accent-color);
        }
        .success-view .personal-note {
            font-style: italic;
            font-size: 1.2em;
            color: #8affc1;
        }
         .success-view .clue-reveal {
            font-size: 1.5em;
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        /* --- 【新功能】最終單字遊戲樣式 --- */
        .letter-pool {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .letter-tile {
            background-color: var(--secondary-color);
            color: var(--bg-color);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .letter-tile:hover {
            transform: scale(1.1);
        }
        .letter-tile.used {
            opacity: 0.2;
            pointer-events: none;
        }
        .answer-slots-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        .answer-word {
            display: flex;
            gap: 5px;
        }
        .answer-slot {
            width: 35px;
            height: 45px;
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            color: var(--text-color);
            font-weight: bold;
            cursor: pointer;
        }
        /* --- -------------------- --- */

        hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <div id="clue-tracker">線索碎片：<span id="clue-display"></span></div>
    <div class="container" id="main-container"></div>
    <script>
        // ===================================================================================
        // ============================  遊戲資料庫 & 個人化設定  ============================
        // ===================================================================================

        const yourName = "你的名字"; 

        const puzzleData = [
            {
                riddle: "年份，是我們記憶中最後一個可以自由呼吸、無需口罩的完整年份。而日期，在俄羅斯，這一天是紀念勝利的『勝利日』。",
                answer: ["20190509", "2019/05/09"],
                clues: ["E", "S"],
                photo: null, 
                note: "從那天起，我們之間，日日是好日。"
            },
            {
                riddle: "這道謎題，無關異國風情，只關乎一個重要的『第一次』。為了慶祝你的第一個生日，我訂的餐廳不是牛排，也不是義大利麵。請問，那個為我們揭開無數慶祝序幕的二字料理『風格』是什麼？",
                answer: "泰式",
                clues: ["T", "O"],
                photo: "photo2.jpg",
                note: "那天的主角是你，但最秀色可餐的也是你。"
            },
            {
                riddle: "我們的首次旅行。那座城市被現代人戲稱為『一個適合眾神居住、卻不太適合人類工作的奇幻之地』，並且，它是台灣六都之中，至今唯一沒有捷運系統通車的直轄市。這座步調獨特的城市是？",
                answer: "台南",
                clues: ["W", "O"],
                photo: "photo3.jpg",
                note: "我們旅程的起點，也是故事的序篇。"
            },
            {
                riddle: "這道謎題，關於我們最平凡也最珍貴的日常。無論是在公園的草地上，還是在河堤的夕陽下，總有『他』的身影陪著我們散步。請問，我們最棒的散步夥伴，他的五個字母英文名字是？",
                answer: "Sunny",
                clues: ["D", "I"],
                photo: "photo4.jpg",
                note: "我們生命中最溫暖、最療癒的存在。"
            },
            {
                riddle: "關於我們的第一次出國旅行。比起大阪的章魚燒和京都的清水寺，我猜你印象最深的，應該是在奈良被鹿『追殺』的陰影吧？請問，這個讓你留下爆笑陰影的二字國度是哪裡？",
                answer: "日本",
                clues: ["W", "E"],
                photo: "photo5.jpg",
                note: "去哪裡不重要，重要的是和誰一起去。"
            },
            {
                riddle: "那場演唱會，對我們來說不只是一晚的狂歡，而是一個『新篇章』的開始。從那天起，一起追蹤她們的新歌、看她们的消息，成了我們之間的一個新默契。請問，開啟了我們這個共同話題的團體，其名稱為何？",
                answer: "babymonster",
                clues: ["N", "N"],
                photo: "photo6.jpg",
                note: "陪你一起聲嘶力竭，是我做過最搖滾的事。"
            },
            {
                riddle: "那款充滿了我們共同焦慮的遊戲。它的背景音樂，就是我們互相大喊『飯燒焦了！』和『盤子在哪？！』的聲音。遊戲的單一英文詞標題，完美描述了我們 90% 的料理成品最終的狀態。它是什麼？",
                answer: "overcooked",
                clues: ["E", "V"],
                photo: null,
                note: "就算手忙腳亂，我們依然是彼此的最佳拍檔。"
            },
            {
                riddle: "這道謎題，關於一個我們即將面臨的挑戰。那間密室的主題，巧妙地顛覆了日常：它將一個本該是洗滌疲憊、最私密的放鬆行為，變成了一場懸疑驚悚的考驗。這間密室的單一漢字名稱，正是那個被它重新定義的『日常行為』。它是？",
                answer: "浴",
                clues: ["I"],
                photo: "photo8.jpg",
                note: "無論現實有多少謎，只要和你一起，就一定能解開。"
            },
            {
                riddle: "我們共同達到的最高點。從那裡俯瞰，腳下的城市像一塊精密的電路板，河流是閃爍的銀色焊錫。這座建築坐落於首爾一個巨大的複合園區內，旁邊就是一座著名的室內遊樂園。它的三字名稱是？",
                answer: "樂天塔",
                clues: ["V"],
                photo: "photo9.jpg",
                note: "和你一起看過的風景，永遠是最美的。"
            }
        ];

        const finalAnswer = {
            part1: "vivienne",
            part2: "westwood"
        };
        const finalGiftLocation = "臥室的書櫃第三層"; // 【請務必修改這裡】

        // ===================================================================================
        // ================================  遊戲核心邏輯  =================================
        // ===================================================================================

        const mainContainer = document.getElementById('main-container');
        let gameState = {
            currentPuzzle: 0,
            completedPuzzles: [], // 【BUG修正】用這個來追蹤已完成的題目
            collectedClues: []
        };

        function saveGame() { localStorage.setItem('birthdayPuzzleState', JSON.stringify(gameState)); }
        function loadGame() {
            const savedState = localStorage.getItem('birthdayPuzzleState');
            if (savedState) gameState = JSON.parse(savedState);
        }

        function updateClueTracker() {
            const display = document.getElementById('clue-display');
            let clueText = "";
            const totalClues = 16;
            for (let i = 0; i < totalClues; i++) {
                clueText += (i < gameState.collectedClues.length ? gameState.collectedClues[i] : "_") + " ";
            }
            display.textContent = clueText.trim();
        }

        function renderPuzzle(index) {
            let content = '';
            // 【邏輯優化】只有第一次玩 (localStorage為空) 且是第一題時，才顯示開場白
            if (index === 0 && !localStorage.getItem('birthdayPuzzleState')) {
                content += `<h1>致我最珍貴的對手，</h1><p>我擅自借走了九個我們之間最閃亮的記憶碎片，<br>將它們鎖在了這個只為妳開啟的空間裡。</p><p>別擔心，它們安然無恙，<br>只是在等待它們真正的主人前來認領。</p><p><strong>而妳，是唯一的挑戰者。</strong></p><p>接下來的每一道詰問，都對應著一段被封鎖的時光。<br>當妳給出正確的答案，那段記憶便會「還原」，<br>同時，妳將獲得一枚解鎖最終祕密的「線索碎片」。</p><p>集齊所有碎片，妳就能揭開我為妳準備的、最終的驚喜。</p><p>那麼，準備好了嗎？</p><hr>`;
            }
            const puzzle = puzzleData[index];
            content += `<h2>第 ${index + 1} 題</h2><p class="riddle">${puzzle.riddle}</p><div class="input-area"><input type="text" id="answer-input" placeholder="請在此輸入答案..." onkeydown="if(event.key==='Enter') checkAnswer()"><button onclick="checkAnswer()">提交答案</button></div>`;
            mainContainer.innerHTML = content;
            document.getElementById('answer-input').focus();
        }
        
        function renderSuccessView(index) {
            const puzzle = puzzleData[index];
            const photoHTML = puzzle.photo ? `<img src="${puzzle.photo}" alt="回憶照片 ${index + 1}">` : '';
            mainContainer.innerHTML = `<div class="success-view"><h2>記憶鎖定解除。妳證明了自己。</h2><p>一段塵封的時光，被妳親手還原了。</p>${photoHTML}<p class="personal-note">“${puzzle.note}”</p><p>這是妳應得的獎勵... 一枚關鍵的「線索碎片」：</p><p class="clue-reveal">${puzzle.clues.join(', ')}</p><hr><button onclick="nextStep()">> 前往下一道詰問</button></div>`;
        }

        function checkAnswer() {
            const index = gameState.currentPuzzle;
            const userInput = document.getElementById('answer-input').value.trim();
            const correctAnswers = puzzleData[index].answer;
            
            let isCorrect = false;
            if (Array.isArray(correctAnswers)) {
                isCorrect = correctAnswers.some(ans => userInput.toLowerCase() === ans.toLowerCase());
            } else {
                isCorrect = userInput.toLowerCase() === correctAnswers.toLowerCase();
            }

            if (isCorrect) {
                // 【BUG修正】只有當這題還沒被完成過，才加入新的線索
                if (!gameState.completedPuzzles.includes(index)) {
                    const newClues = puzzleData[index].clues;
                    gameState.collectedClues.push(...newClues);
                    gameState.completedPuzzles.push(index);
                }
                updateClueTracker();
                renderSuccessView(index);
                saveGame();
            } else {
                alert("答案不對喔，再想一想！或者...妳需要提示嗎？ ;)");
                document.getElementById('answer-input').value = "";
            }
        }

        function nextStep() {
            gameState.currentPuzzle++;
            if (gameState.currentPuzzle < puzzleData.length) {
                renderPuzzle(gameState.currentPuzzle);
            } else {
                renderFinale();
            }
            saveGame();
        }
        
        // 【新功能】渲染最終的單字遊戲畫面
        function renderFinale() {
            let shuffledClues = [...gameState.collectedClues].sort(() => Math.random() - 0.5);
            let letterTilesHTML = shuffledClues.map((letter, i) => 
                `<div class="letter-tile" id="tile-${i}" onclick="selectLetter(this, '${letter}')">${letter}</div>`
            ).join('');

            let answerSlotsHTML = `
                <div class="answer-word" id="word1">
                    ${Array(8).fill('<div class="answer-slot" onclick="returnLetter(this)"></div>').join('')}
                </div>
                <div class="answer-word" id="word2">
                    ${Array(8).fill('<div class="answer-slot" onclick="returnLetter(this)"></div>').join('')}
                </div>
            `;

            mainContainer.innerHTML = `<h2>恭喜通關，我的記憶主人。</h2><p>妳憑藉著智慧與默契，成功還原了所有被我藏起來的珍貴回憶，<br>證明了妳是它們唯一的主人。</p><p>現在，只剩下最後一道鎖。<br>解開它，就能找到我為妳準備的真正驚喜。</p><hr><p>請用妳收集到的 16 枚線索碎片，拼出最終的答案：</p><div class="letter-pool">${letterTilesHTML}</div><p><strong>最後的提示：</strong> 這是一個工整的「<strong>8+8</strong>」組合，就像它的品牌 Logo 一樣，對稱而又充滿個性。答案本身，充滿了英倫的搖滾精神喔。</p><div class="answer-slots-container">${answerSlotsHTML}</div><div class="input-area"><button onclick="checkFinalAnswer()">揭曉最終答案</button></div>`;
        }

        // 【新功能】單字遊戲的互動邏輯
        function selectLetter(tileElement, letter) {
            const slots1 = document.querySelectorAll('#word1 .answer-slot');
            const slots2 = document.querySelectorAll('#word2 .answer-slot');
            const allSlots = [...slots1, ...slots2];

            let emptySlot = allSlots.find(slot => slot.textContent === '');
            
            if (emptySlot) {
                emptySlot.textContent = letter;
                emptySlot.dataset.tileId = tileElement.id; // 記錄是哪個字母磚塊來的
                tileElement.classList.add('used');
            }
        }

        function returnLetter(slotElement) {
            const tileId = slotElement.dataset.tileId;
            if (tileId) {
                const tileElement = document.getElementById(tileId);
                tileElement.classList.remove('used');
                slotElement.textContent = '';
                delete slotElement.dataset.tileId;
            }
        }

        // 【新功能】檢查單字遊戲的答案
        function checkFinalAnswer() {
            const slots1 = document.querySelectorAll('#word1 .answer-slot');
            const slots2 = document.querySelectorAll('#word2 .answer-slot');
            
            const word1 = Array.from(slots1).map(slot => slot.textContent).join('').toLowerCase();
            const word2 = Array.from(slots2).map(slot => slot.textContent).join('').toLowerCase();

            if (word1 === finalAnswer.part1 && word2 === finalAnswer.part2) {
                mainContainer.innerHTML = `<h1>完全正確！</h1><h2>生日快樂，我生命中唯一的主角。</h2><p class="personal-note" style="font-size: 1.5em;">現在，請前往 ${finalGiftLocation}，領取屬於妳的搖滾徽章吧！</p><hr><p>—— 不再是竊賊，而是永遠愛妳的，${yourName}</p>`;
                localStorage.removeItem('birthdayPuzzleState');
            } else {
                alert("不對喔，再檢查一下拼字！");
            }
        }

        // --- 遊戲初始化 ---
        loadGame();
        if (gameState.currentPuzzle >= puzzleData.length) {
            renderFinale();
        } else {
            renderPuzzle(gameState.currentPuzzle);
        }
        updateClueTracker();
        
        // 供您自己測試用的重設功能 (在瀏覽器開發者工具的Console中輸入 resetGame() 來使用)
        function resetGame() { if (confirm("確定要重設所有遊戲進度嗎？")) { localStorage.removeItem('birthdayPuzzleState'); location.reload(); } }
    </script>
</body>
</html>



